<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="theme-color" content="#000000"/>
    <title>SimplySave app</title>
    <script type="text/javascript">
        // Placeholder data. Real data will be managed by wrapper app.
        let data = {
            notes: [
                {
                    id: '1',
                    title: 'Test note',
                    folderId: '1',
                    createdTimestamp: new Date().getTime(),
                    editedTimestamp: new Date().getTime(),
                    isPrivate: false
                },
                {
                    id: '2', title: 'Very nice note',
                    folderId: '1',
                    createdTimestamp: new Date().getTime(),
                    editedTimestamp: new Date().getTime(),
                    isPrivate: false
                },
                {
                    id: '3', title: 'Something else!',
                    folderId: '1',
                    createdTimestamp: new Date().getTime(),
                    editedTimestamp: new Date().getTime(),
                    isPrivate: false
                },
            ],
            notesContent: [
                { id: '1', content: 'fadsfasfsdfdasf' },
                { id: '2', content: 'Hello world!' },
                { id: '3', content: 'Well well well what we have here...' }
            ],
            folders: [
                { id: '1', title: 'Demo folder', icon: 'star' },
                { id: '2', title: 'Something else', icon: 'cloud' },
                { id: '3', title: 'Whatever', icon: 'cube' },
            ],
            config: {
                dataDirPath: './TestDir',
                notesSort: 'alphabet',
            }
        }

        // Placeholder API. Real implementation should be provided by wrapper app.
        window._simplysave_create_note = async (createData) => {
            const newId = (+data.notes.reduce((prev, cur) => {
                return +prev.id > +cur.id ? prev : cur
            }).id + 1).toString()

            data.notes = [...data.notes, {
                id: newId,
                title: createData.title,
                folderId: createData.folderId,
                createdTimestamp: Date.now(),
                editedTimestamp: Date.now(),
                isPrivate: createData.isPrivate
            }]

            // Important: at this point, content is already encrypted if isPrivate === true.
            // Wrapper app or sync server cannot decrypt it!
            data.notesContent = [...data.notesContent, {
                id: newId,
                content: createData.content
            }]

            return Object.assign({}, data.notes[data.notes.length - 1])
        }
        window._simplysave_save_note = async (saveData) => {
            const index = data.notesContent.findIndex(x => x.id === saveData.id)
            data.notesContent[index] = {
                id: saveData.id,
                content: saveData.content
            }
            console.log(data.notesContent[index])
            return data.notesContent[index]
        }
        window._simplysave_rename_note = async (renameData) => {
            const index = data.notes.findIndex(x => x.id === renameData.id)
            const newNotes = [...data.notes]
            newNotes[index] = {
                ...newNotes[index],
                title: renameData.newTitle,
            }
            data.notes = newNotes
            return Object.assign([], data.notes)
        }
        window._simplysave_note_change_folder = async (noteId, folderId) => {
            const index = data.notes.findIndex(x => x.id === noteId)
            const newNotes = [...data.notes]
            newNotes[index] = {
                ...newNotes[index],
                folderId: folderId,
            }
            data.notes = newNotes
            return Object.assign([], data.notes)
        }
        window._simplysave_delete_note = async (id) => {
            data.notes = data.notes.filter(x => x.id !== id)
            return Object.assign([], data.notes)
        }
        window._simplysave_load = async () => {
            return Object.assign({}, data)
        }
        window._simplysave_load_content = async (noteId) => {
            return data.notesContent.find(x => x.id === noteId).content
        }
        window._simplysave_set_folders = async (folders_list) => {
            data.folders = [...folders_list]
            console.log(data.folders)
        }

        window._simplysave_load_config = async () => {
            return Object.assign({}, data.config)
        }
        window._simplysave_save_config = async (config) => {
            data.config = Object.assign({}, config)
            return Object.assign({}, data.config)
        }
    </script>
</head>
<body>
<noscript>You need to enable JavaScript to run this app.</noscript>
<div id="root"></div>
</body>
</html>
